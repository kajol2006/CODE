import serial
import time
from serial.tools import list_ports

# Auto-detect LoRa serial port on Raspberry Pi
def detect_lora_port():
    ports = list_ports.comports()
    for port in ports:
        if "ttyAMA" in port.device or "serial0" in port.device:
            return port.device
    return None

lora_port = detect_lora_port()
if not lora_port:
    print("LoRa module not detected!")
    exit()

# Open serial port
ser = serial.Serial(lora_port, baudrate=9600, timeout=1)
time.sleep(2)  # wait for module to initialize

print(f"LoRa sender running on {lora_port}...")

try:
    while True:
        msg = input("Enter message to send: ")
        ser.write((msg + '\n').encode('utf-8'))  # send message
        print(f"Sent: {msg}")
except KeyboardInterrupt:
    print("Exiting sender...")
    ser.close()
